--
-- PostgreSQL database dump
--

-- Dumped from database version 11.2
-- Dumped by pg_dump version 11.2

-- Started on 2020-03-29 20:17:01

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', 'public', false);
SET check_function_bodies = false;
SET client_min_messages = warning;
SET row_security = off;

CREATE EXTENSION IF NOT exists pgcrypto;

DROP TABLE if exists public.users cascade;
DROP TABLE if exists public.lendings cascade;
DROP TABLE if exists public.customers cascade;
DROP TABLE if exists public.books cascade;
DROP TABLE if exists public.authors cascade;
SET default_tablespace = '';

SET default_with_oids = false;

--
-- TOC entry 196 (class 1259 OID 93723)
-- Name: authors; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.authors (
    id integer NOT NULL,
    full_name character varying(100) NOT NULL,
    dob date NOT NULL
);


ALTER TABLE public.authors OWNER TO postgres;

--
-- TOC entry 197 (class 1259 OID 93726)
-- Name: authors_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.authors ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.authors_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 198 (class 1259 OID 93728)
-- Name: books; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.books (
    id integer NOT NULL,
    author_id integer NOT NULL,
    title character varying(100) NOT NULL,
    pub_year integer
);


ALTER TABLE public.books OWNER TO postgres;

--
-- TOC entry 199 (class 1259 OID 93731)
-- Name: books_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.books ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.books_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 200 (class 1259 OID 93733)
-- Name: customers; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.customers (
    id integer NOT NULL,
    first_name character varying(100) NOT NULL,
    last_name character varying(100) NOT NULL,
    dob date NOT NULL,
    note text
);


ALTER TABLE public.customers OWNER TO postgres;

--
-- TOC entry 201 (class 1259 OID 93739)
-- Name: customers_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.customers ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.customers_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 202 (class 1259 OID 93741)
-- Name: lendings; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.lendings (
    id integer NOT NULL,
    customer_id integer NOT NULL,
    book_id integer NOT NULL,
    lending_start timestamp without time zone NOT NULL,
    lending_end timestamp without time zone,
    lending_start_user_id integer,
	lending_end_user_id integer
);

ALTER TABLE public.lendings OWNER TO postgres;

--
-- TOC entry 203 (class 1259 OID 93744)
-- Name: lendings_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.lendings ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.lendings_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 204 (class 1259 OID 93746)
-- Name: users; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.users (
    id integer NOT NULL,
    email varchar(100) NOT NULL,
    pwd varchar(80) NOT NULL,
    salt varchar(200) NOT NULL,	
	iterations_count integer not null,
    last_login timestamp without time zone,
	deleted boolean NOT NULL default false
);


ALTER TABLE public.users OWNER TO postgres;

--
-- TOC entry 205 (class 1259 OID 93749)
-- Name: users_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.users ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.users_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);

INSERT INTO public.users (id, email, pwd, salt, iterations_count, last_login) VALUES(1, 'daniele@library.com', 
	'39cfcfdf899d6884509a668e9fdd1c82bcfd6c0b206da1234cac7b26f18950be3eff7170d0a281ed', 
	'{52246926-1C78-4C21-8878-2F4A07BD4298}', 100000, CURRENT_TIMESTAMP);
INSERT INTO public.users (id, email, pwd, salt, iterations_count, last_login) VALUES(2, 'peter@library.com', 
	'c1d14fb63b9c3384a7b14e67b23d3b12dd0e98bd11b055f0f18b85f039d734156660e4b66cb70163', 
	'{A4C07D11-F614-49A5-BB17-B76D83EAE49A}', 100000, CURRENT_TIMESTAMP);

--
-- TOC entry 2199 (class 0 OID 93723)
-- Dependencies: 196
-- Data for Name: authors; Type: TABLE DATA; Schema: public; Owner: postgres
--

INSERT INTO public.authors (id, full_name, dob) VALUES (2, 'Charlotte BrontÃ«', '1816-04-21');
INSERT INTO public.authors (id, full_name, dob) VALUES (3, 'Mark Twain', '1835-11-30');
INSERT INTO public.authors (id, full_name, dob) VALUES (4, 'Daniel Defoe', '1660-09-13');
INSERT INTO public.authors (id, full_name, dob) VALUES (5, 'William Shakespeare', '1564-04-23');
INSERT INTO public.authors (id, full_name, dob) VALUES (6, 'Alexandre Dumas', '1802-07-24');
INSERT INTO public.authors (id, full_name, dob) VALUES (7, 'Robert Louis Stevenson', '1850-11-13');
INSERT INTO public.authors (id, full_name, dob) VALUES (8, 'Carlo Collodi', '1826-11-24');
INSERT INTO public.authors (id, full_name, dob) VALUES (9, 'Dante Alighieri', '1321-09-14');


--
-- TOC entry 2201 (class 0 OID 93728)
-- Dependencies: 198
-- Data for Name: books; Type: TABLE DATA; Schema: public; Owner: postgres
--

INSERT INTO public.books (id, author_id, title, pub_year) VALUES (4, 8, 'The Adventures of Pinocchio', 1883);
INSERT INTO public.books (id, author_id, title, pub_year) VALUES (5, 3, 'The Adventures of Tom Sawyer', 1875);
INSERT INTO public.books (id, author_id, title, pub_year) VALUES (6, 4, 'Robinson Crusoe', 1719);
INSERT INTO public.books (id, author_id, title, pub_year) VALUES (7, 5, 'Romeo and Juliet', 1595);
INSERT INTO public.books (id, author_id, title, pub_year) VALUES (8, 5, 'A Midsummer Night''s Dream', 1595);
INSERT INTO public.books (id, author_id, title, pub_year) VALUES (9, 5, 'King Lear', 1603);
INSERT INTO public.books (id, author_id, title, pub_year) VALUES (10, 6, 'The Count of Monte Cristo', 1844);
INSERT INTO public.books (id, author_id, title, pub_year) VALUES (11, 6, 'The Three Musketeers', 1844);
INSERT INTO public.books (id, author_id, title, pub_year) VALUES (12, 7, 'Treasure Island', 1882);
INSERT INTO public.books (id, author_id, title, pub_year) VALUES (13, 7, 'The Strange Case of Dr. Jekyll and Mr. Hyde', 1886);
INSERT INTO public.books (id, author_id, title, pub_year) VALUES (14, 3, 'The Adventures of Huckleberry Finn', 1884);
INSERT INTO public.books (id, author_id, title, pub_year) VALUES (15, 9, 'The Divine Comedy', 1308);

--
-- TOC entry 2203 (class 0 OID 93733)
-- Dependencies: 200
-- Data for Name: customers; Type: TABLE DATA; Schema: public; Owner: postgres
--

INSERT INTO public.customers (id, first_name, last_name, dob, note) VALUES (1, 'Daniele', 'Teti', '1979-11-04', NULL);
INSERT INTO public.customers (id, first_name, last_name, dob, note) VALUES (2, 'Peter', 'Parker', '1969-10-01', NULL);
INSERT INTO public.customers (id, first_name, last_name, dob, note) VALUES (3, 'Sue', 'Storm', '1980-08-04', NULL);
INSERT INTO public.customers (id, first_name, last_name, dob, note) VALUES (4, 'Scott', 'Summers', '1975-04-24', NULL);
INSERT INTO public.customers (id, first_name, last_name, dob, note) VALUES (5, 'Giuseppe', 'Verdi', '1813-10-10', NULL);
INSERT INTO public.customers (id, first_name, last_name, dob, note) VALUES (6, 'Mario', 'Rossi', '2000-05-10', NULL);
INSERT INTO public.customers (id, first_name, last_name, dob, note) VALUES (7, 'Jack', 'Black', '1980-10-05', NULL);
INSERT INTO public.customers (id, first_name, last_name, dob, note) VALUES (8, 'Dero', 'Embarca', '1990-01-05', NULL);
INSERT INTO public.customers (id, first_name, last_name, dob, note) VALUES (9, 'Prof. Essio', 'Nal', '1989-07-02', NULL);




--
-- TOC entry 2205 (class 0 OID 93741)
-- Dependencies: 202
-- Data for Name: lendings; Type: TABLE DATA; Schema: public; Owner: postgres
--


INSERT INTO public.lendings (id, customer_id, book_id, lending_start, lending_end, lending_start_user_id) VALUES (1, 2, 8, '2020-02-12 00:00:00', NULL, 1);
INSERT INTO public.lendings (id, customer_id, book_id, lending_start, lending_end, lending_start_user_id) VALUES (2, 4, 11, '2020-03-12 00:00:00', NULL, 1);
INSERT INTO public.lendings (id, customer_id, book_id, lending_start, lending_end, lending_start_user_id) VALUES (3, 3, 10, '2020-01-10 00:00:00', NULL, 2);


--
-- TOC entry 2207 (class 0 OID 93746)
-- Dependencies: 204
-- Data for Name: users; Type: TABLE DATA; Schema: public; Owner: postgres
--



--
-- TOC entry 2214 (class 0 OID 0)
-- Dependencies: 197
-- Name: authors_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.authors_id_seq', 1, false);


--
-- TOC entry 2215 (class 0 OID 0)
-- Dependencies: 199
-- Name: books_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.books_id_seq', (SELECT max(id) from public.books), true);


--
-- TOC entry 2216 (class 0 OID 0)
-- Dependencies: 201
-- Name: customers_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.customers_id_seq', (SELECT max(id) from public.customers), true);

--
-- TOC entry 2217 (class 0 OID 0)
-- Dependencies: 203
-- Name: lendings_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.lendings_id_seq', 4, false);


--
-- TOC entry 2218 (class 0 OID 0)
-- Dependencies: 205
-- Name: users_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.users_id_seq', (SELECT max(id) from public.users), true);


--
-- TOC entry 2065 (class 2606 OID 93752)
-- Name: authors authors_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.authors
    ADD CONSTRAINT authors_pkey PRIMARY KEY (id);


--
-- TOC entry 2067 (class 2606 OID 93754)
-- Name: books books_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.books
    ADD CONSTRAINT books_pkey PRIMARY KEY (id);


--
-- TOC entry 2069 (class 2606 OID 93756)
-- Name: customers customers_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.customers
    ADD CONSTRAINT customers_pkey PRIMARY KEY (id);


--
-- TOC entry 2071 (class 2606 OID 93758)
-- Name: lendings lendings_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lendings
    ADD CONSTRAINT lendings_pkey PRIMARY KEY (id);


--
-- TOC entry 2073 (class 2606 OID 93760)
-- Name: users users_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_pkey PRIMARY KEY (id);

CREATE UNIQUE INDEX users_email_idx ON public.users (email);

ALTER TABLE ONLY public.lendings
    ADD CONSTRAINT lendings_users_fk FOREIGN KEY (lending_start_user_id) REFERENCES public.users(id);

ALTER TABLE ONLY public.lendings
    ADD CONSTRAINT lendings_users_end_fk FOREIGN KEY (lending_end_user_id) REFERENCES public.users(id);

--
-- TOC entry 2074 (class 2606 OID 93761)
-- Name: books books_authors_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.books
    ADD CONSTRAINT books_authors_fk FOREIGN KEY (author_id) REFERENCES public.authors(id);


--
-- TOC entry 2075 (class 2606 OID 93766)
-- Name: lendings lendings_books_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lendings
    ADD CONSTRAINT lendings_books_fk FOREIGN KEY (book_id) REFERENCES public.books(id);


--
-- TOC entry 2076 (class 2606 OID 93771)
-- Name: lendings lendings_customers_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.lendings
    ADD CONSTRAINT lendings_customers_fk FOREIGN KEY (customer_id) REFERENCES public.customers(id);


--
-- TOC entry 2077 (class 2606 OID 93776)
-- Name: lendings lendings_users_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--


-- Completed on 2020-03-29 20:17:01

--
-- PostgreSQL database dump complete
--

